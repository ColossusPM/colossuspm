<div class="kanban-container">
  <div
    class="lane-container"
    *ngFor="let lane of lanes"
    pDroppable
    [pDroppableDisabled]="!!editTask"
    (onDrop)="onDrop($event, lane.status)"
    (onDragEnter)="onDragEnter(lane.status)"
    (onDragLeave)="onDragLeave()"
    [ngClass]="{ 'drag-over': isDragOver === lane.status }"
  >
    <div class="lane-header">
      <h3>{{ lane.name }}</h3>
    </div>

    <div class="task-list">
      <div
        *ngFor="let task of getTasksByStatus(lane.status)"
        class="task-item"
        pDraggable
        [pDraggableDisabled]="!!editTask"
        (dragstart)="onDragStart($event, task)"
        (dragend)="onDragEnd()"
        [ngClass]="{ dragging: draggedTask?.id === task.id }"
      >
        <span>{{ task.title }}</span>
          <span *ngIf="task.deadline">{{ task.deadline | date }}</span>
        <div class="task-actions">
          <button
            pButton
            icon="pi pi-pencil"
            class="p-button-text p-button-sm"
            (click)="edit(task)"
          ></button>
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-text p-button-danger p-button-sm"
            (click)="deleteTask(task)"
          ></button>
        </div>
      </div>

      <div *ngIf="editTask && editTask.status === lane.status" class="edit-task-input">
        <input
          type="text"
          pInputText
          [(ngModel)]="editTask.title"
          placeholder="Edit task title"
        />
        <p-calendar [(ngModel)]="editTask.deadline" placeholder="Edit deadline"></p-calendar>
        <button
          pButton
          icon="pi pi-check"
          class="p-button-success p-button-sm"
          (click)="saveEdit()"
        ></button>
        <button
          pButton
          icon="pi pi-times"
          class="p-button-text p-button-sm"
          (click)="cancelEdit()"
        ></button>
      </div>

      <div class="add-task-input">
        <input
          type="text"
          pInputText
          [(ngModel)]="newTaskTitle[lane.status]"
          placeholder="Add new task"
          (keyup.enter)="createTask(lane.status)"
        />
        <p-calendar [(ngModel)]="newTaskDeadline[lane.status]" placeholder="Deadline"></p-calendar>
        <button
          pButton
          icon="pi pi-plus"
          class="p-button-sm"
          (click)="createTask(lane.status)"
        ></button>
      </div>
    </div>
  </div>
</div>